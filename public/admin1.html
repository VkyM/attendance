<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <style>
    body { font-family: Arial; background: #f7f7f7; padding: 20px; }
    input, button { margin: 5px; padding: 8px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background: #eee; }
    .late { background: #ffcccc; }
  </style>
</head>
<body>
  <h2>Admin Dashboard</h2>

  <input id="month" type="month">
  <button onclick="loadAttendance()">Load Attendance</button>

  <h3>Monthly Attendance</h3>
  <table id="attTable">
    <tr><th>Username</th><th>Date</th><th>Login Time</th><th>Status</th></tr>
  </table>

  <h3>Leave Requests</h3>
  <table id="leaveTable">
    <tr><th>Username</th><th>Date</th><th>Reason</th><th>Status</th><th>Action</th></tr>
  </table>

<script>
  async function loadAttendance() {
    const month = document.getElementById("month").value;
    const res = await fetch(`/admin/attendance/${month}`);
    const data = await res.json();
    const table = document.getElementById("attTable");
    table.innerHTML = `<tr><th>Username</th><th>Date</th><th>Login Time</th><th>Status</th></tr>`;
    data.forEach(a => {
      table.innerHTML += `<tr class="${a.late ? 'late' : ''}">
        <td>${a.username}</td>
        <td>${a.date}</td>
        <td>${a.loginTime}</td>
        <td>${a.late ? 'Late' : 'On time'}</td>
      </tr>`;
    });
  }

  async function loadLeaves() {
    const res = await fetch("/admin/leaves");
    const data = await res.json();
    const table = document.getElementById("leaveTable");
    table.innerHTML = `<tr><th>Username</th><th>Date</th><th>Reason</th><th>Status</th><th>Action</th></tr>`;
    data.forEach(l => {
      table.innerHTML += `<tr>
        <td>${l.username}</td>
        <td>${l.date}</td>
        <td>${l.reason}</td>
        <td>${l.status}</td>
        <td>
          <button onclick="updateLeave('${l.username}','${l.date}','Approved')">Approve</button>
          <button onclick="updateLeave('${l.username}','${l.date}','Rejected')">Reject</button>
        </td>
      </tr>`;
    });
  }

  async function updateLeave(username, date, status) {
    await fetch("/admin/leave/update", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, date, status })
    });
    loadLeaves();
  }

  loadLeaves();
</script>

</body>
</html>
